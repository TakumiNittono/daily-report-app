# プッシュ通知をアプリ内に表示する機能

## 概要

PushAlertで送信したプッシュ通知の内容をアプリ内に表示し、通知履歴を確認できる機能です。

## セットアップ手順

### 1. データベーステーブルの作成

SupabaseのSQLエディタで、`supabase-notifications-setup.sql` の内容を実行してください：

```sql
-- supabase-notifications-setup.sql の内容を実行
```

これにより、`notifications`テーブルが作成されます。

### 2. 機能の確認

実装が完了すると、以下の機能が利用可能になります：

- **お知らせタブ**: メイン画面のタブに「お知らせ」タブが追加されます
- **通知一覧**: 送信された通知の一覧を表示します
- **既読管理**: 通知を既読にマークできます
- **通知削除**: 不要な通知を削除できます

## 通知をデータベースに保存する方法

### 方法1: PushAlert Webhookを使用（推奨）

PushAlertダッシュボードでWebhookを設定し、通知送信時にアプリのAPIエンドポイントに通知データを送信します。

1. **APIエンドポイントの作成**（今後実装予定）
2. **PushAlertダッシュボードでWebhookを設定**

### 方法2: 手動で通知を保存するAPIエンドポイント

管理者が通知を送信した後、手動でデータベースに保存するAPIエンドポイントを作成します。

### 方法3: PushAlert APIを使用

PushAlertのAPIを使用して、送信された通知を取得し、データベースに保存します。

## 通知データの構造

通知テーブルには以下の情報が保存されます：

- `title`: 通知タイトル
- `body`: 通知本文
- `url`: 通知クリック時の遷移先URL
- `is_read`: 既読フラグ
- `pushalert_notification_id`: PushAlertの通知ID（オプション）
- `icon`: 通知アイコンURL（オプション）
- `image`: 通知画像URL（オプション）
- `data`: その他の通知データ（JSON形式）

## 今後の実装予定

- [ ] PushAlert Webhookの実装
- [ ] 通知を手動で追加する管理者機能
- [ ] 通知のバッチ削除機能
- [ ] 通知フィルター機能（既読/未読）

## 使用方法

1. **通知の確認**: メイン画面の「お知らせ」タブをクリック
2. **通知を既読にする**: 通知をクリックするか、「全て既読にする」ボタンをクリック
3. **通知を削除**: 通知の右側の「×」ボタンをクリック

## トラブルシューティング

### 通知が表示されない

1. `notifications`テーブルが作成されているか確認
2. データベースに通知データが保存されているか確認
3. RLSポリシーが正しく設定されているか確認

### 通知が保存されない

1. Service Workerが正しく動作しているか確認
2. ブラウザのコンソールでエラーを確認
3. Supabaseのログでエラーを確認

